# Makefile for compiling and installing F# MonoDevelop plugin on Mono
#   run 'make' to compile the plugin (dll + debug info)
#   run 'make install' to copy the compiled plugin to MonoDevelop folders
#   run 'make package' to create a deployment binary package with addin (for repository)

# Here are a few paths that need to be configured first:
MDROOT  = INSERT_MD_ROOT
#MONOBIN = INSERT_MONO_BIN

MDTOOL = $(MONO) $(MDROOT)/bin/mdtool.exe 

TARGETS = bin/FSharp.Core.dll bin/FSharpBinding.dll  bin/FSharpBinding.Gui.dll

.PHONY: all

all: binding aspnet

binding:
	(cd MonoDevelop.FSharpBinding && xbuild MonoDevelop.FSharp.fsproj /p:MDROOT=$(MDROOT))

aspnet:
	(cd addins/MonoDevelop.FSharp.AspNet.Mvc && xbuild MonoDevelop.FSharp.AspNet.Mvc.fsproj /p:MDROOT=$(MDROOT))

#install:
#	cp -pr bin/* $(MDADDIN)/BackendBindings/

install-mac:
	-rm -fr ~/Library/Application\ Support/MonoDevelop-3.0/LocalInstall/Addins/*FSharp*
	@-mkdir ~/Library/Application\ Support/MonoDevelop-3.0/LocalInstall/Addins/MonoDevelop.FSharpBinding.3.2.1
	cp -pr bin/* ~/Library/Application\ Support/MonoDevelop-3.0/LocalInstall/Addins/MonoDevelop.FSharpBinding.3.2.1

#uninstall:
#	rm -fr $(MDADDIN)/BackendBindings/FSharp*
#	rm -fr ~/Library/Application\ Support/MonoDevelop-3.0/LocalInstall/Addins/*.FSharp*

package: $(TARGETS)
	@mkdir -p bin/repository
	@mkdir -p repository
	cp $(TARGETS) bin/repository
	cp MonoDevelop.FSharpBinding/FSharpBinding.addin.xml bin/repository
	$(MDTOOL) setup pack bin/repository/FSharpBinding.addin.xml -d:repository

clean:
	rm -r bin
